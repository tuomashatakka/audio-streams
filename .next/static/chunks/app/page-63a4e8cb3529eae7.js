(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{273:()=>{},2160:()=>{},3037:(e,t,a)=>{Promise.resolve().then(a.bind(a,9004))},4327:()=>{throw Error('Module build failed (from ./node_modules/next/dist/compiled/mini-css-extract-plugin/loader.js):\nHookWebpackError: Module build failed (from ./node_modules/next/dist/build/webpack/loaders/postcss-loader/src/index.js):\nSyntaxError\n\n(53:25) /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/app/components/playback-controls/PlaybackControls.css Missed semicolon\n\n  51 |   width: 48px;\n  52 |   height: 48px;\n> 53 |   border: 4px solid rgba(0,0,0,0.5)\n     |                         ^\n  54 |   color: var(--text-inverse);\n  55 |   box-shadow: var(--shadow-md);\n\n    at tryRunOrWebpackError (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:316142)\n    at __webpack_require_module__ (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:131548)\n    at __nested_webpack_require_161494__ (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:130983)\n    at /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:131840\n    at symbolIterator (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/neo-async/async.js:1:14444)\n    at done (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/neo-async/async.js:1:14824)\n    at Hook.eval [as callAsync] (eval at create (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:14:9224), <anonymous>:15:1)\n    at /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:130703\n    at symbolIterator (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/neo-async/async.js:1:14402)\n    at timesSync (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/neo-async/async.js:1:5027)\n-- inner error --\nError: Module build failed (from ./node_modules/next/dist/build/webpack/loaders/postcss-loader/src/index.js):\nSyntaxError\n\n(53:25) /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/app/components/playback-controls/PlaybackControls.css Missed semicolon\n\n  51 |   width: 48px;\n  52 |   height: 48px;\n> 53 |   border: 4px solid rgba(0,0,0,0.5)\n     |                         ^\n  54 |   color: var(--text-inverse);\n  55 |   box-shadow: var(--shadow-md);\n\n    at Object.<anonymous> (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/build/webpack/loaders/css-loader/src/index.js??ruleSet[1].rules[13].oneOf[10].use[2]!/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/build/webpack/loaders/postcss-loader/src/index.js??ruleSet[1].rules[13].oneOf[10].use[3]!/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/app/components/playback-controls/PlaybackControls.css:1:7)\n    at /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:962742\n    at Hook.eval [as call] (eval at create (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:14:9002), <anonymous>:7:1)\n    at /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:131581\n    at tryRunOrWebpackError (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:316096)\n    at __webpack_require_module__ (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:131548)\n    at __nested_webpack_require_161494__ (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:130983)\n    at /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/webpack/bundle5.js:29:131840\n    at symbolIterator (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/neo-async/async.js:1:14444)\n    at done (/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/compiled/neo-async/async.js:1:14824)\n\nGenerated code for /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/build/webpack/loaders/css-loader/src/index.js??ruleSet[1].rules[13].oneOf[10].use[2]!/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/node_modules/next/dist/build/webpack/loaders/postcss-loader/src/index.js??ruleSet[1].rules[13].oneOf[10].use[3]!/Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/app/components/playback-controls/PlaybackControls.css\n1 | throw new Error("Module build failed (from ./node_modules/next/dist/build/webpack/loaders/postcss-loader/src/index.js):\\nSyntaxError\\n\\n(53:25) /Users/tvndra/Documents/Projects/Audio/audioblocks/audio-streams/app/components/playback-controls/PlaybackControls.css Missed semicolon\\n\\n  51 |   width: 48px;\\n  52 |   height: 48px;\\n> 53 |   border: 4px solid rgba(0,0,0,0.5)\\n     |                         ^\\n  54 |   color: var(--text-inverse);\\n  55 |   box-shadow: var(--shadow-md);\\n");')},4622:()=>{},5776:()=>{},7851:()=>{},9004:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>J});var s=a(5155),n=a(2115),i=function(e){return e.WAV="audio/wav",e.MP3="audio/mpeg",e.M4A="audio/mp4",e.OGG="audio/ogg",e.FLAC="audio/flac",e}({});let o=["#ff006e","#fb5607","#ffbe0b","#8ecae6","#219ebc","#023047","#3a86ff","#7209b7"];var r=function(e){return e.DECODE_AUDIO="decode_audio",e.AUDIO_DECODED="audio_decoded",e.DECODE_ERROR="decode_error",e.GENERATE_WAVEFORM="generate_waveform",e.WAVEFORM_GENERATED="waveform_generated",e}({});function l(e){return e.type.startsWith("audio/")||Object.values(i).includes(e.type)}function c(){return o[Math.floor(Math.random()*o.length)]}function d(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}function u(e){let t=Math.floor(e/60),a=Math.floor(e%60),s=Math.floor(e%1*100);return"".concat(t.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"),".").concat(s.toString().padStart(2,"0"))}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=e.createGain();return a.gain.value=t,a}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=e.createStereoPanner();return a.pan.value=Math.min(Math.max(t,-1),1),a}function h(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=e.getChannelData(a),n=Math.floor(s.length/t),i=[];for(let e=0;e<t;e++){let t=e*n,a=Math.min(t+n,s.length),o=0;for(let e=t;e<a;e++){let t=Math.abs(s[e]);t>o&&(o=t)}i.push(o)}return i}function g(e){return(null==e?void 0:e.length)===0?16:Math.max(Math.max(...(e||[]).flatMap(e=>e.clipIds.map(e=>e.startTime+e.duration))),16)}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;try{let a=new OfflineAudioContext(1,e.length,e.sampleRate),s=a.createBufferSource();s.buffer=e,s.connect(a.destination),s.start(0);let n=await a.startRendering();return h(n,t,0)}catch(a){return console.error("Failed to generate waveform data offline:",a),h(e,t,0)}}var x=function(e){return e[e.WHOLE=1]="WHOLE",e[e.HALF=2]="HALF",e[e.QUARTER=4]="QUARTER",e[e.EIGHTH=8]="EIGHTH",e[e.SIXTEENTH=16]="SIXTEENTH",e[e.THIRTY_SECOND=32]="THIRTY_SECOND",e}({});function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;return arguments.length>2&&void 0!==arguments[2]&&arguments[2],60/e/(t/4)}function b(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{numerator:4,denominator:4};return e+t*k(a,s,n)}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0,s=Math.max(t,e);return void 0!==a&&(s=Math.min(a,s)),s}class y{onMessage(e){let t=Math.random().toString(36);this.messageHandlers.set(t,e)}removeMessageHandler(e){this.messageHandlers.delete(e)}postMessage(e){setTimeout(()=>{this.messageHandlers.forEach(t=>t({data:e}))},0)}async processMessage(e){try{switch(e.type){case r.DECODE_AUDIO:{let{id:t,arrayBuffer:a,fileName:s}=e;try{let e=new OfflineAudioContext(2,44100,44100),n=await e.decodeAudioData(a.slice(0));this.postMessage({type:r.AUDIO_DECODED,id:t,audioBuffer:n,fileName:s,duration:n.duration,sampleRate:n.sampleRate})}catch(e){console.error("Audio decoding failed:",e),this.postMessage({type:r.DECODE_ERROR,id:t,error:e instanceof Error?e.message:"Unknown decoding error"})}break}case r.GENERATE_WAVEFORM:{let{id:t,audioBuffer:a,samples:s}=e;try{let e=await f(a,s);this.postMessage({type:r.WAVEFORM_GENERATED,id:t,waveformData:e})}catch(e){console.error("Waveform generation failed:",e),this.postMessage({type:r.DECODE_ERROR,id:t,error:e instanceof Error?e.message:"Waveform generation failed"})}break}default:console.warn("Unknown message type:",e.type)}}catch(t){console.error("Audio decoder error:",t),this.postMessage({type:r.DECODE_ERROR,id:e.id||"unknown",error:t instanceof Error?t.message:"Audio decoder processing error"})}}terminate(){this.messageHandlers.clear()}constructor(){this.messageHandlers=new Map}}let v=new y;class C{updateState(e,t,a){this._state={...e},this._project={...t},this._allClips=[...a],this.mainGainNode&&(this.mainGainNode.gain.value=this._state.volume),this._state.isPlaying&&this.audioContext&&Math.abs(this._state.currentSamples-this.lastUpdateSamples)>1e3&&(console.log("AudioEngine: External seek detected, restarting playback."),this.stopPlayback(),setTimeout(()=>{this._state.isPlaying&&this.startPlayback()},10))}async initializeAudioContext(){if(this.audioContext){if("running"===this.audioContext.state||"suspended"===this.audioContext.state&&(await this.audioContext.resume(),"running"===this.audioContext.state))return!0;"closed"===this.audioContext.state&&(this.audioContext=null)}if(!this.audioContext)try{return this.audioContext=new AudioContext({sampleRate:44100,latencyHint:"interactive"}),this.mainGainNode=p(this.audioContext,this._state.volume),this.mainGainNode.connect(this.audioContext.destination),this.onAudioContextInitialized(this.audioContext.sampleRate),console.log("Audio context initialized:",{sampleRate:this.audioContext.sampleRate,state:this.audioContext.state}),!0}catch(e){console.error("Failed to initialize audio context:",e)}return!1}async resumeAudioContext(){if(!await this.initializeAudioContext()||!this.audioContext)return!1;if("suspended"===this.audioContext.state)try{return await this.audioContext.resume(),"running"===this.audioContext.state}catch(e){return console.error("Failed to resume audio context:",e),!1}return"running"===this.audioContext.state}setupAudioNodes(){this.audioContext&&this.mainGainNode&&(this.trackNodes.forEach(e=>{e.clipNodes.forEach(e=>{try{e.source.stop()}catch(e){}e.source.disconnect(),e.gain.disconnect(),e.panner.disconnect()}),e.gain.disconnect(),e.panner.disconnect()}),this.trackNodes.clear(),this._project.tracks.forEach(e=>{let t=p(this.audioContext,e.muted?0:e.volume),a=m(this.audioContext,e.pan);t.connect(a),a.connect(this.mainGainNode);let s=new Map;this.trackNodes.set(e.id,{gain:t,panner:a,clipNodes:s})}))}scheduleClip(e,t){if(!this.audioContext||!e.audioBuffer)return;let a=this.secondsToSamples(e.startTime),s=this._state.currentSamples;if(a+this.secondsToSamples(e.duration)<s)return;let n=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=e.createBufferSource();return s.buffer=t,s.playbackRate.value=a,s}(this.audioContext,e.audioBuffer,Math.pow(2,e.pitch/12)),i=p(this.audioContext,e.volume),o=m(this.audioContext);n.connect(i),i.connect(o),o.connect(t.gain);let r=Math.max(0,this.samplesToSeconds(s-a)),l=this.audioContext.currentTime+Math.max(0,this.samplesToSeconds(a-s));n.start(l,r),t.clipNodes.set(e.id,{source:n,gain:i,panner:o}),n.onended=()=>{t.clipNodes.delete(e.id)}}updateTime(){if(!this.audioContext||!this._state.isPlaying){this.rafId=null;return}let e=this.updateTime.bind(this),t=this.audioContext.currentTime-this.startTime,a=this.secondsToSamples(Math.max(0,t));if(Math.abs(a-this.lastUpdateSamples)>1e3&&(this.lastUpdateSamples=a,this.onUpdateCurrentSamples(a)),this._state.isLooping&&a>=this._state.loopEndSamples){let e=this._state.loopStartSamples;this.startTime=this.audioContext.currentTime-this.samplesToSeconds(e),this.lastUpdateSamples=e,this.onUpdateCurrentSamples(e),this.stopPlayback(),this.startPlayback()}else!this._state.isLooping&&a>=this._state.loopEndSamples&&(this.stopPlayback(),this.onUpdateCurrentSamples(this._state.loopEndSamples));this._state.isPlaying?this.rafId=requestAnimationFrame(e):this.rafId=null}async startPlayback(){if(!await this.resumeAudioContext()||!this.audioContext)return;let e=this._state.currentSamples;this.startTime=this.audioContext.currentTime-this.samplesToSeconds(e),this.lastUpdateSamples=e,this.setupAudioNodes(),this._project.tracks.forEach(e=>{let t=this.trackNodes.get(e.id);t&&e.clipIds.map(e=>this._allClips.find(t=>t.id===e)).filter(Boolean).forEach(e=>{this.scheduleClip(e,t)})}),this.rafId&&cancelAnimationFrame(this.rafId);let t=this.updateTime.bind(this);this.rafId=requestAnimationFrame(t)}stopPlayback(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.audioContext&&(this.pausedAtSamples=this._state.currentSamples,this.trackNodes.forEach(e=>{e.clipNodes.forEach(e=>{try{e.source.stop()}catch(e){}}),e.clipNodes.clear()}))}get sampleRate(){return this._state.sampleRate}samplesToSeconds(e){return e/this._state.sampleRate}secondsToSamples(e){return Math.round(e*this._state.sampleRate)}getAudioContext(){return this.audioContext}dispose(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null,this.mainGainNode=null,this.trackNodes.clear(),console.log("AudioEngine disposed.")}constructor(e,t,a,s){this.audioContext=null,this.mainGainNode=null,this.trackNodes=new Map,this.rafId=null,this.startTime=0,this.pausedAtSamples=0,this.lastUpdateSamples=0,this._allClips=[],this._state={...e},this._project={...t},this.onUpdateCurrentSamples=a,this.onAudioContextInitialized=s}}let j={project:{id:d(),name:"New Project",tracks:[],bpm:120,timeSignature:{numerator:4,denominator:4},duration:16},clips:[],audioEngine:{isPlaying:!1,currentSamples:0,isLooping:!1,loopStartSamples:0,loopEndSamples:705600,volume:.8,sampleRate:44100,isInitialized:!1},ui:{selectedClipId:null,pixelsPerSecond:50,isProcessing:!1,dragState:{isDragging:!1,dragType:null,hoveredTrackId:null,showNewTrackPlaceholder:!1,placeholderClip:null}},fileProcessing:[]};function S(e,t){switch(t.type){case"INITIALIZE_AUDIO_CONTEXT":return{...e,audioEngine:{...e.audioEngine,isInitialized:!0,sampleRate:t.sampleRate}};case"SET_PLAYING":return{...e,audioEngine:{...e.audioEngine,isPlaying:t.isPlaying}};case"SET_CURRENT_SAMPLES":return{...e,audioEngine:{...e.audioEngine,currentSamples:t.samples}};case"SET_LOOPING":return{...e,audioEngine:{...e.audioEngine,isLooping:t.isLooping}};case"SET_VOLUME":return{...e,audioEngine:{...e.audioEngine,volume:t.volume}};case"SET_PIXELS_PER_SECOND":return{...e,ui:{...e.ui,pixelsPerSecond:Math.max(4,Math.min(400,t.pixelsPerSecond))}};case"SELECT_CLIP":return{...e,ui:{...e.ui,selectedClipId:t.clipId}};case"SET_PROCESSING":return{...e,ui:{...e.ui,isProcessing:t.isProcessing}};case"ADD_PROCESSING_FILES":return{...e,fileProcessing:[...e.fileProcessing,...t.files]};case"UPDATE_PROCESSING_FILE":return{...e,fileProcessing:e.fileProcessing.map(e=>e.id===t.id?{...e,...t.updates}:e)};case"REMOVE_PROCESSING_FILE":return{...e,fileProcessing:e.fileProcessing.filter(e=>e.id!==t.id)};case"ADD_CLIP":return{...e,clips:[...e.clips,t.clip]};case"ADD_TRACK":{let a=t.track||{id:d(),name:"Track ".concat(e.project.tracks.length+1),color:c(),volume:.8,pan:0,muted:!1,solo:!1,clipIds:[],index:e.project.tracks.length},s=[...e.project.tracks,a],n=g(s.map(t=>({...t,clips:t.clipIds.map(t=>e.clips.find(e=>e.id===t)).filter(Boolean)})));return{...e,project:{...e.project,tracks:s,duration:n}}}case"ASSIGN_CLIP_TO_TRACK":{let a=e.project.tracks.map(e=>e.id===t.trackId?{...e,clipIds:[...e.clipIds,t.clipId]}:e),s=g(a.map(t=>({...t,clips:t.clipIds.map(t=>e.clips.find(e=>e.id===t)).filter(Boolean)})));return{...e,project:{...e.project,tracks:a,duration:s}}}case"UPDATE_TRACK":return{...e,project:{...e.project,tracks:e.project.tracks.map(e=>e.id===t.trackId?{...e,...t.updates}:e)}};case"UPDATE_CLIP":{let a=e.clips.map(e=>e.id===t.clipId?{...e,...t.updates}:e),s=g(e.project.tracks.map(e=>({...e,clips:e.clipIds.map(e=>a.find(t=>t.id===e)).filter(Boolean)})));return{...e,clips:a,project:{...e.project,duration:s}}}case"UPDATE_CLIP_WAVEFORM":return{...e,clips:e.clips.map(e=>e.id===t.clipId?{...e,waveformData:t.waveformData}:e)};case"SET_DRAG_STATE":return{...e,ui:{...e.ui,dragState:{...e.ui.dragState,...t.dragState}}};case"RESET_DRAG_STATE":return{...e,ui:{...e.ui,dragState:{isDragging:!1,dragType:null,hoveredTrackId:null,showNewTrackPlaceholder:!1,placeholderClip:null}}};case"REMOVE_TRACK":{let a=e.project.tracks.find(e=>e.id===t.trackId);if(!a)return e;let s=e.project.tracks.filter(e=>e.id!==t.trackId),n=e.clips.filter(e=>!a.clipIds.includes(e.id)),i=g(s.map(e=>({...e,clips:e.clipIds.map(e=>n.find(t=>t.id===e)).filter(Boolean)})));return{...e,clips:n,project:{...e.project,tracks:s,duration:i}}}case"MOVE_CLIP_TO_TRACK":{let a=e.project.tracks.map(e=>e.clipIds.includes(t.clipId)?{...e,clipIds:e.clipIds.filter(e=>e!==t.clipId)}:e.id===t.targetTrackId?{...e,clipIds:[...e.clipIds,t.clipId]}:e),s=e.clips.map(e=>e.id===t.clipId?{...e,trackId:t.targetTrackId,startTime:t.newStartTime}:e),n=g(a.map(e=>({...e,clips:e.clipIds.map(e=>s.find(t=>t.id===e)).filter(Boolean)})));return{...e,clips:s,project:{...e.project,tracks:a,duration:n}}}default:return e}}let _=(0,n.createContext)(null);function T(e){let{children:t}=e,[a,i]=(0,n.useReducer)(S,j),o=(0,n.useRef)(null),u=(0,n.useRef)(null),p=(0,n.useCallback)(e=>{i({type:"SET_CURRENT_SAMPLES",samples:e})},[i]),m=(0,n.useCallback)(e=>{i({type:"INITIALIZE_AUDIO_CONTEXT",sampleRate:e})},[i]);(0,n.useEffect)(()=>(g(),o.current||(o.current=new C(a.audioEngine,a.project,p,m)),o.current.updateState(a.audioEngine,a.project,a.clips),()=>{}),[a.audioEngine,a.project,a.clips,p,m]);let h=(0,n.useCallback)(async()=>o.current?await o.current.resumeAudioContext():(console.warn("AudioEngine not initialized yet."),!1),[]),f=(0,n.useCallback)(async()=>{o.current&&await o.current.startPlayback()},[]),x=(0,n.useCallback)(()=>{var e;null==(e=o.current)||e.stopPlayback()},[]);(0,n.useEffect)(()=>{a.audioEngine.isPlaying?f():x()},[a.audioEngine.isPlaying,f,x]);let k=(0,n.useCallback)(e=>o.current?o.current.samplesToSeconds(e):0,[]),b=(0,n.useCallback)(e=>o.current?o.current.secondsToSamples(e):0,[]),E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=[...e].filter(l);if(0===a.length)return;i({type:"SET_PROCESSING",isProcessing:!0});let s=a.map(e=>({id:d(),fileName:e.name,status:"processing"}));i({type:"ADD_PROCESSING_FILES",files:s}),v.onMessage(e=>{let t=e.data;switch(t.type){case r.AUDIO_DECODED:t.audioBuffer&&t.fileName&&t.duration&&y(t.id,t.audioBuffer,t.fileName,t.duration,t.trackId);break;case r.DECODE_ERROR:t.error&&T(t.id,t.error);break;case r.WAVEFORM_GENERATED:t.waveformData&&P(t.id,t.waveformData)}}),a.forEach((e,a)=>{let n=s[a].id,i=new FileReader;i.onload=a=>{var s;let i=null==(s=a.target)?void 0:s.result;i&&v.processMessage({type:r.DECODE_AUDIO,id:n,arrayBuffer:i,fileName:e.name,trackId:t})},i.readAsArrayBuffer(e)})},y=(0,n.useCallback)((e,t,s,n,o)=>{i({type:"UPDATE_PROCESSING_FILE",id:e,updates:{status:"completed"}});let l=d(),u={id:l,name:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e.replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"").substring(0,t)}(s.replace(/\.[^/.]+$/,"")),trackId:"",audioBuffer:t,waveformData:[],startTime:0,duration:n,volume:1,pitch:0,color:c(),isLoading:!1};i({type:"ADD_CLIP",clip:u});let p=a.ui.dragState,m=o||p.hoveredTrackId||"";m?i({type:"ASSIGN_CLIP_TO_TRACK",clipId:l,trackId:m}):i({type:"ADD_TRACK",track:{id:m=d(),name:"Track ".concat(a.project.tracks.length+1),color:u.color,volume:.8,pan:0,muted:!1,solo:!1,clipIds:[l],index:a.project.tracks.length}}),i({type:"UPDATE_CLIP",clipId:l,updates:{trackId:m}}),v.processMessage({type:r.GENERATE_WAVEFORM,id:l,audioBuffer:t,samples:Math.min(1e3,Math.floor(100*n))}),i({type:"RESET_DRAG_STATE"}),setTimeout(()=>{i({type:"REMOVE_PROCESSING_FILE",id:e}),a.fileProcessing.length<=1&&i({type:"SET_PROCESSING",isProcessing:!1})},1e3)},[a.project.tracks.length,a.fileProcessing.length,a.ui.dragState,i]),T=(0,n.useCallback)((e,t)=>{console.error("Audio decode error:",t),i({type:"UPDATE_PROCESSING_FILE",id:e,updates:{status:"error",error:t}}),setTimeout(()=>{i({type:"REMOVE_PROCESSING_FILE",id:e}),a.fileProcessing.length<=1&&i({type:"SET_PROCESSING",isProcessing:!1})},3e3)},[a.fileProcessing.length,i]),P=(0,n.useCallback)((e,t)=>{i({type:"UPDATE_CLIP_WAVEFORM",clipId:e,waveformData:t})},[i]),N=(0,n.useCallback)(()=>{var e;null==(e=u.current)||e.click()},[]),A=(0,n.useCallback)(e=>{let t=Array.from(e.target.files||[]);t.length>0&&(E(t),e.target.value="")},[E]);return(0,s.jsxs)(_.Provider,{value:{state:a,dispatch:i,resumeAudioContext:h,samplesToSeconds:k,secondsToSamples:b,openFileDialog:N,handleFilesSelected:E},children:[t,(0,s.jsx)("input",{type:"file",accept:"audio/*,.wav,.mp3,.m4a,.mp4,.ogg,.flac",ref:u,multiple:!0,style:{display:"none"},onChange:A})]})}let P=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),N=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var A={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let D=(0,n.forwardRef)((e,t)=>{let{color:a="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:r="",children:l,iconNode:c,...d}=e;return(0,n.createElement)("svg",{ref:t,...A,width:s,height:s,stroke:a,strokeWidth:o?24*Number(i)/Number(s):i,className:N("lucide",r),...d},[...c.map(e=>{let[t,a]=e;return(0,n.createElement)(t,a)}),...Array.isArray(l)?l:[l]])}),w=(e,t)=>{let a=(0,n.forwardRef)((a,s)=>{let{className:i,...o}=a;return(0,n.createElement)(D,{ref:s,iconNode:t,className:N("lucide-".concat(P(e)),i),...o})});return a.displayName="".concat(e),a},I=w("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),M=w("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function R(e){let{duration:t,currentTime:a,pixelsPerSecond:i,bpm:o,timeSignature:r,height:l=48,isCollapsed:c=!1,onScrub:d,onZoomChange:p,onToggleCollapse:m}=e,h=(0,n.useRef)(null),g=(0,n.useRef)(!1),[f,x]=(0,n.useState)(0),k=t*i,b=(0,n.useMemo)(()=>{let e=1/i,a=1,s=.25;e>.5?(a=10,s=2):e>.1?(a=5,s=1):e>.02&&(a=2,s=.5);let n=[],l=[];for(let e=0;e<=t;e+=s){let t=e*i,s=e%a==0;n.push({x:t,time:e,isMajor:s,label:s&&t>0?u(e):null})}if(i>20){let e=o/60,a=r.numerator,s=1/e,n=s*a;for(let e=0;e<=t;e+=s){let t=e*i,a=e%n<.001;l.push({x:t,isBarStart:a})}}return{timeMarkers:n,beatMarkers:l}},[t,i,o,r]),E=(0,n.useCallback)(e=>{if(!h.current)return;let a=h.current.getBoundingClientRect(),s=Math.max(0,Math.min((e.clientX-a.left)/i,t));g.current=!0,d(s);let n=e=>{if(!g.current||!h.current)return;let a=h.current.getBoundingClientRect();d(Math.max(0,Math.min((e.clientX-a.left)/i,t)))},o=()=>{g.current=!1,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)},[i,t,d]),y=(0,n.useCallback)(e=>{console.log(e),e.preventDefault(),p(Math.max(10,Math.min(200,i*(e.deltaY>0?.9803921568627451:1.02))))},[i,p]);(0,n.useLayoutEffect)(()=>{var e;if(!h.current)return;let t=null==(e=h.current.parentElement)?void 0:e.getBoundingClientRect();t&&x(t.width),console.log(t)},[h]);let v=a*i,C=(0,n.useCallback)(()=>p(.8*i),[i]),j=(0,n.useCallback)(()=>p(1.125*i),[i]),S=(0,n.useMemo)(()=>Math.round(i),[i]);return(0,s.jsxs)("div",{className:"timeline-container ".concat(g.current?"scrubbing":""," ").concat(c?"collapsed":""),style:{width:f},children:[(0,s.jsxs)("div",{ref:h,className:"timeline-svg-container",onMouseDown:E,onWheel:y,style:{width:f},children:[(0,s.jsxs)("svg",{className:"timeline-svg",width:f,height:l,viewBox:"0 0 ".concat(f," ").concat(l),role:"img","aria-label":"Timeline showing ".concat(u(t)," duration, current time ").concat(u(a)),children:[(0,s.jsx)("rect",{width:k,height:l,fill:"#222222"}),b.beatMarkers.map((e,t)=>(0,s.jsx)("line",{x1:e.x,y1:0,x2:e.x,y2:e.isBarStart?15:8,stroke:e.isBarStart?"#ff5500":"#ffbe0b",strokeWidth:e.isBarStart?2:1},"beat-".concat(t))),b.timeMarkers.map((e,t)=>(0,s.jsxs)("g",{children:[(0,s.jsx)("line",{x1:e.x,y1:l-(e.isMajor?20:10),x2:e.x,y2:l,stroke:e.isMajor?"#666666":"#444444",strokeWidth:1}),e.label&&(0,s.jsx)("text",{x:e.x+2,y:l-32,fill:"#aaaaaa",fontSize:"10",fontFamily:"system-ui",dominantBaseline:"hanging",children:e.label})]},"time-".concat(t)))]}),(0,s.jsxs)("div",{className:"playhead",style:{transform:"translateX(".concat(v,"px)"),height:"".concat(l,"px")},children:[(0,s.jsx)("div",{className:"playhead-handle"}),(0,s.jsx)("div",{className:"playhead-line"})]})]}),(0,s.jsxs)("div",{className:"timeline-controls ".concat(c?"collapsed":""),children:[(0,s.jsx)("button",{className:"collapse-button",onClick:m,title:c?"Expand controls":"Collapse controls",children:c?(0,s.jsx)(I,{size:16}):(0,s.jsx)(M,{size:16})}),!c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"zoom-button",onClick:C,title:"Zoom out",children:"-"}),(0,s.jsxs)("span",{className:"zoom-level",children:[S,"px/s"]}),(0,s.jsx)("button",{className:"zoom-button",onClick:j,title:"Zoom in",children:"+"})]})]})]})}a(2160);let L=function(e){let{waveformData:t,width:a,height:i,color:o="currentColor",backgroundColor:r="transparent",strokeWidth:l=.5,className:c}=e,d=(0,n.useMemo)(()=>{if(!t.length)return"";let e=i/2,s=i/2-2,n=[],o=[];for(let i=0;i<t.length;i++){let r=i/(t.length-1)*a,l=t[i]*s,c=e-l,d=e+l;0===i?(n.push("M ".concat(r," ").concat(c)),o.push("M ".concat(r," ").concat(d))):(n.push("L ".concat(r," ").concat(c)),o.push("L ".concat(r," ").concat(d)))}return[...n,...o.reverse(),"Z"].join(" ")},[t,a,i]),u=(0,n.useMemo)(()=>{if(!t.length)return"";let e=i/2,s=i/2-2,n=[],o=[];for(let i=0;i<t.length;i++){let r=i/(t.length-1)*a,l=t[i]*s,c=e-l,d=e+l;0===i?(n.push("M ".concat(r," ").concat(c)),o.push("M ".concat(r," ").concat(d))):(n.push("L ".concat(r," ").concat(c)),o.push("L ".concat(r," ").concat(d)))}return[n.join(" "),o.join(" ")].join(" ")},[t,a,i]);return t.length?(0,s.jsxs)("svg",{style:{color:o},className:"audio-waveform ".concat(c),width:a,height:i,role:"img","aria-label":"Audio waveform visualization",children:[(0,s.jsx)("rect",{className:"background",width:a,height:i,fill:r}),(0,s.jsx)("path",{className:"fill",d:d,fill:o}),(0,s.jsx)("path",{className:"stroke",d:u,stroke:o})]}):(0,s.jsx)("svg",{style:{color:o},className:"audio-waveform ".concat(c),width:a,height:i,role:"img","aria-label":"Empty audio waveform",children:(0,s.jsx)("rect",{className:"background",width:a,height:i})})};a(4622);let O=e=>{let{onMove:t,onResize:a,onMoveToTrack:s}=e,i=(0,n.useRef)(null),o=(0,n.useRef)({width:null,action:null,x:null,y:null}),r=()=>{var e;let t=null==(e=i.current)?void 0:e.getBoundingClientRect();return{x:null==t?void 0:t.x,y:null==t?void 0:t.y,width:null==t?void 0:t.width,time:Date.now()}},l=e=>{let t=e.clientX-o.current.startX,a=e.clientY-o.current.startY;i.current&&(i.current.style.transform="translate(".concat(t,"px, ").concat(a,"px)"))},c=()=>{o.current.x=null,o.current.y=null,o.current.width=null,o.current.action=null,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c),i.current&&(i.current.style.transform="translate(0, 0)"),r()};return i},U=function(e){let{clip:t,pixelsPerSecond:a,sampleRate:i,trackHeight:o,isSelected:r=!1,onSelect:l,onMove:c,onResize:d,onMoveToTrack:p}=e,m=O({onMove:c,onResize:d,onMoveToTrack:p}),h=a/i,g=t.duration*h,f=(0,n.useMemo)(()=>o-4,[o]),x=(0,n.useCallback)(e=>{e.stopPropagation(),null==l||l(t.id)},[t.id,l]);return(0,s.jsx)("div",{ref:m,className:"audio-clip",style:{height:"".concat(f,"px"),width:"".concat(g/h,"px"),left:"".concat(t.startTime*a,"px"),backgroundColor:"".concat(t.color,"40")||0,borderColor:r?"".concat(t.color,"a0"):"transparent"},onClick:x,title:"".concat(t.name," - ").concat(u(t.duration)),children:t.isLoading?(0,s.jsxs)("div",{className:"clip-loading",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("span",{children:"Processing..."})]}):(0,s.jsxs)(s.Fragment,{children:[t.waveformData.length>0&&(0,s.jsx)(L,{waveformData:t.waveformData,height:f,color:t.color,className:"clip-waveform"}),(0,s.jsxs)("div",{className:"clip-label",children:[(0,s.jsx)("span",{className:"clip-name",children:t.name}),(0,s.jsx)("span",{className:"clip-time",children:u(t.duration)})]}),(0,s.jsx)("div",{className:"resize-handle"})]})})},F=w("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),G=w("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),H=w("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]),z=w("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),B=w("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);a(5776);let V=function(e){let{track:t,pixelsPerSecond:a,trackHeight:i,projectDuration:o,selectedClipId:r,isCollapsed:l=!1,onTrackUpdate:c,onClipSelect:d,onClipMove:u,onClipResize:p,onClipMoveToTrack:m,onTrackRemove:h,onFileUpload:g,onTrackHover:f,isHovered:x=!1,showPlaceholder:k=!1}=e,b=(0,n.useCallback)(e=>{let a=parseFloat(e.target.value);c(t.id,{volume:a})},[t.id,c]),E=(0,n.useCallback)(e=>{let a=parseFloat(e.target.value);c(t.id,{pan:a})},[t.id,c]),y=(0,n.useCallback)(()=>{c(t.id,{muted:!t.muted})},[t.id,t.muted,c]),v=(0,n.useCallback)(()=>{c(t.id,{solo:!t.solo})},[t.id,t.solo,c]),C=(0,n.useCallback)(e=>{c(t.id,{name:e.target.value})},[t.id,c]),j=(0,n.useCallback)(()=>{window.confirm('Are you sure you want to remove the track "'.concat(t.name,'"?'))&&(null==h||h(t.id))},[t.id,t.name,h]),S=o*a,_=(0,n.useCallback)(()=>{k&&(null==f||f(t.id))},[k,f,t.id]),T=(0,n.useCallback)(()=>{k&&(null==f||f(null))},[k,f]);return(0,s.jsxs)("div",{className:"audio-track ".concat(x?"hovered":""," ").concat(k?"drag-target":""),"data-track-id":t.id,onMouseEnter:_,onMouseLeave:T,children:[(0,s.jsxs)("header",{className:"track-header ".concat(l?"collapsed":""),children:[(0,s.jsx)("input",{type:"text",value:t.name,onChange:C,className:"track-name-input",style:{color:t.color}}),(0,s.jsxs)("div",{className:"track-controls",children:[(0,s.jsx)("button",{className:"track-button mute-button ".concat(t.muted?"active":""),onClick:y,title:t.muted?"Unmute":"Mute",children:t.muted?(0,s.jsx)(F,{size:14}):(0,s.jsx)(G,{size:14})}),(0,s.jsx)("button",{className:"track-button solo-button ".concat(t.solo?"active":""),onClick:v,title:t.solo?"Unsolo":"Solo",children:(0,s.jsx)(H,{size:14})}),(0,s.jsx)("button",{className:"track-button remove-button",onClick:j,title:"Remove track",children:(0,s.jsx)(z,{size:14})}),(0,s.jsxs)("label",{className:"slider-container",children:[(0,s.jsx)("span",{className:"slider-label",children:"Vol"}),(0,s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:t.volume,onChange:b,className:"volume-slider",title:"Volume: ".concat(Math.round(100*t.volume),"%")}),(0,s.jsx)("output",{className:"slider-value",children:Math.round(100*t.volume)})]}),(0,s.jsxs)("label",{className:"slider-container",children:[(0,s.jsx)("span",{className:"slider-label",children:"Pan"}),(0,s.jsx)("input",{type:"range",min:"-1",max:"1",step:"0.01",value:t.pan,onChange:E,className:"pan-slider",title:"Pan: ".concat(t.pan>0?"R":t.pan<0?"L":"C").concat(Math.abs(Math.round(100*t.pan)))}),(0,s.jsx)("output",{className:"slider-value",children:0===t.pan?"C":"".concat(t.pan>0?"R":"L").concat(Math.abs(Math.round(100*t.pan)))})]})]})]}),(0,s.jsxs)("div",{className:"track-content",style:{width:S},children:[(0,s.jsx)("div",{className:"track-lane",style:{width:S,height:i,borderLeft:"3px solid ".concat(t.color)}}),t.clipIds.map(e=>(0,s.jsx)(U,{clip:e,pixelsPerSecond:a,trackHeight:i,isSelected:r===e.id,onSelect:d,onMove:u,onResize:p,onMoveToTrack:m},e.id)),0===t.clipIds.length&&!x&&(0,s.jsxs)("div",{className:"empty-track-upload",children:[(0,s.jsx)("label",{className:"upload-button btn-primary",htmlFor:"file-upload-".concat(t.id),children:(0,s.jsx)(B,{size:16})}),(0,s.jsx)("input",{id:"file-upload-".concat(t.id),type:"file",accept:"audio/*",multiple:!0,onChange:e=>{let a=e.target.files;a&&g&&(g(a,t.id),e.target.value="")},style:{display:"none"}})]}),x&&k&&(0,s.jsx)("div",{className:"clip-placeholder",children:(0,s.jsx)("div",{className:"placeholder-content",children:(0,s.jsx)("span",{children:"Drop audio file here"})})})]})]})},W=w("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),X=w("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),K=w("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),q=w("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);a(4327);let Y=function(e){let{isPlaying:t,currentTime:a,bpm:i,timeSignature:o,volume:r,isLooping:l,onPlay:c,onPause:d,onStop:p,onVolumeChange:m,onLoopToggle:h,onUserGesture:g}=e,f=(0,n.useCallback)(e=>{m(parseFloat(e.target.value))},[m]),x=(0,n.useCallback)(()=>{null==g||g(),c()},[c,g]);return(0,s.jsxs)("div",{className:"playback-controls",children:[(0,s.jsxs)("div",{className:"transport-buttons",children:[(0,s.jsx)("button",{className:"transport-button play-pause ".concat(t?"playing":""),onClick:t?d:x,title:t?"Pause":"Play",children:t?(0,s.jsx)(W,{size:20}):(0,s.jsx)(X,{size:20})}),(0,s.jsx)("button",{className:"transport-button stop",onClick:p,title:"Stop",children:(0,s.jsx)(K,{size:18})}),(0,s.jsx)("button",{className:"transport-button loop ".concat(l?"active":""),onClick:h,title:l?"Disable Loop":"Enable Loop",children:(0,s.jsx)(q,{size:18})})]}),(0,s.jsxs)("div",{className:"time-display",children:[(0,s.jsxs)("div",{className:"time-format",children:[(0,s.jsx)("span",{className:"time-value",children:u(a)}),(0,s.jsx)("span",{className:"time-label",children:"Time"})]}),(0,s.jsxs)("div",{className:"time-format",children:[(0,s.jsx)("span",{className:"time-value",children:function(e,t,a){let s=t/60*e,n=a.numerator,i=Math.floor(s/n)+1,o=s%n,r=Math.floor(o)+1,l=Math.floor((o-Math.floor(o))*4)+1;return"".concat(i,".").concat(r,".").concat(l)}(a,i,o)}),(0,s.jsx)("span",{className:"time-label",children:"Bars"})]})]}),(0,s.jsxs)("div",{className:"bpm-display",children:[(0,s.jsx)("span",{className:"bpm-value",children:i}),(0,s.jsx)("span",{className:"bpm-label",children:"BPM"})]}),(0,s.jsxs)("div",{className:"master-volume",children:[(0,s.jsx)(G,{size:16,className:"volume-icon"}),(0,s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:r,onChange:f,className:"master-volume-slider",title:"Master Volume: ".concat(Math.round(100*r),"%")}),(0,s.jsxs)("span",{className:"volume-value",children:[Math.round(100*r),"%"]})]})]})};class Z{enable(){this.isEnabled||(document.addEventListener("keydown",this.boundHandler),this.isEnabled=!0,console.log("\uD83C\uDFB9 Hotkeys enabled"))}disable(){this.isEnabled&&(document.removeEventListener("keydown",this.boundHandler),this.isEnabled=!1,console.log("\uD83C\uDFB9 Hotkeys disabled"))}get enabled(){return this.isEnabled}handleKeyDown(e){if(this.isInputFocused())return;let{code:t,shiftKey:a,ctrlKey:s,metaKey:n,altKey:i}=e;if(s||n||i)return;let o=!1;try{switch(t){case"ArrowLeft":o=a?this.handleShortenClip():this.handleNudgeLeft();break;case"ArrowRight":o=a?this.handleLengthenClip():this.handleNudgeRight();break;case"Space":o=a?this.handleRestartPlayback():this.handleTogglePlayback()}o&&(e.preventDefault(),e.stopPropagation())}catch(e){console.error("Error handling hotkey:",e)}}handleNudgeLeft(){let e=this.config.getSelectedClip();if(!e)return console.log("\uD83C\uDFB9 No clip selected for nudge left"),!1;this.getGridDuration();let t=E(b(e.startTime,-1,this.config.getBPM(),x.SIXTEENTH,this.config.getTimeSignature()),0);return t!==e.startTime&&(this.config.onNudgeLeft(e.id,t),console.log("\uD83C\uDFB9 Nudged clip left: ".concat(e.startTime.toFixed(3),"s → ").concat(t.toFixed(3),"s")),!0)}handleNudgeRight(){let e=this.config.getSelectedClip();if(!e)return console.log("\uD83C\uDFB9 No clip selected for nudge right"),!1;let t=E(b(e.startTime,1,this.config.getBPM(),x.SIXTEENTH,this.config.getTimeSignature()),0,Math.max(0,this.config.getProjectDuration()-e.duration));return t!==e.startTime&&(this.config.onNudgeRight(e.id,t),console.log("\uD83C\uDFB9 Nudged clip right: ".concat(e.startTime.toFixed(3),"s → ").concat(t.toFixed(3),"s")),!0)}handleShortenClip(){let e=this.config.getSelectedClip();if(!e)return console.log("\uD83C\uDFB9 No clip selected for shorten"),!1;let t=this.getGridDuration(),a=e.duration-t,s=Math.max(t,a);return s!==e.duration&&s>0&&(this.config.onShortenClip(e.id,s),console.log("\uD83C\uDFB9 Shortened clip: ".concat(e.duration.toFixed(3),"s → ").concat(s.toFixed(3),"s")),!0)}handleLengthenClip(){let e=this.config.getSelectedClip();if(!e)return console.log("\uD83C\uDFB9 No clip selected for lengthen"),!1;let t=this.getGridDuration(),a=e.duration+t,s=Math.min(this.config.getProjectDuration()-e.startTime,a);return s!==e.duration&&s>e.duration&&(this.config.onLengthenClip(e.id,s),console.log("\uD83C\uDFB9 Lengthened clip: ".concat(e.duration.toFixed(3),"s → ").concat(s.toFixed(3),"s")),!0)}handleTogglePlayback(){return this.config.onTogglePlayback(),console.log("\uD83C\uDFB9 Toggled playback: ".concat(this.config.isPlaying()?"playing":"paused")),!0}handleRestartPlayback(){return this.config.onRestartPlayback(),console.log("\uD83C\uDFB9 Restarted playback from beginning"),!0}getGridDuration(){return k(this.config.getBPM(),x.SIXTEENTH,this.config.getTimeSignature())}isInputFocused(){let e=document.activeElement;if(!e)return!1;let t=e.tagName.toLowerCase(),a="true"===e.getAttribute("contenteditable");return"input"===t||"textarea"===t||"select"===t||a}updateConfig(e){this.config={...this.config,...e}}getGridInfo(){return{duration:this.getGridDuration(),bpm:this.config.getBPM(),gridSize:"1/16 note"}}constructor(e){this.isEnabled=!1,this.config=e,this.boundHandler=this.handleKeyDown.bind(this)}}let $=w("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a(273),a(7851);let Q=function(){var e;let{state:t,dispatch:a,resumeAudioContext:i,samplesToSeconds:o,secondsToSamples:r,handleFilesSelected:c}=function(){let e=(0,n.useContext)(_);if(!e)throw Error("useAudioEngine must be used within an AudioEngineProvider");return e}(),d=(0,n.useRef)(null),[u,p]=(0,n.useState)(!1),m=(0,n.useCallback)(()=>{a({type:"SET_PLAYING",isPlaying:!0})},[a]),h=(0,n.useCallback)(()=>{a({type:"SET_PLAYING",isPlaying:!1})},[a]),f=(0,n.useCallback)(()=>{a({type:"SET_PLAYING",isPlaying:!1}),a({type:"SET_CURRENT_SAMPLES",samples:0})},[a]),x=(0,n.useCallback)(()=>{t.audioEngine.isPlaying?h():m()},[t.audioEngine.isPlaying,m,h]),k=(0,n.useCallback)(()=>{a({type:"SET_CURRENT_SAMPLES",samples:0}),t.audioEngine.isPlaying||m()},[a,t.audioEngine.isPlaying,m]),b=(0,n.useCallback)(async()=>{console.log("User gesture detected - resuming AudioContext"),await i()?console.log("AudioContext successfully resumed"):console.warn("Failed to resume AudioContext")},[i]),E=(0,n.useCallback)(e=>{a({type:"SET_CURRENT_SAMPLES",samples:r(e)})},[r,a]),y=(0,n.useCallback)(e=>{a({type:"SET_VOLUME",volume:e})},[a]),v=(0,n.useCallback)(()=>{a({type:"SET_LOOPING",isLooping:!t.audioEngine.isLooping})},[a,t.audioEngine.isLooping]),C=(0,n.useCallback)((e,t)=>{a({type:"UPDATE_TRACK",trackId:e,updates:t})},[a]),j=(0,n.useCallback)(e=>{a({type:"SELECT_CLIP",clipId:e})},[a]),S=(0,n.useCallback)((e,t)=>{a({type:"UPDATE_CLIP",clipId:e,updates:{startTime:Math.max(0,t)}})},[a]),T=(0,n.useCallback)((e,t)=>{a({type:"UPDATE_CLIP",clipId:e,updates:{duration:Math.max(.1,t)}})},[a]),P=(0,n.useCallback)(e=>{a({type:"SET_PIXELS_PER_SECOND",pixelsPerSecond:e})},[a]),N=(0,n.useCallback)(()=>{a({type:"ADD_TRACK"})},[a]),A=(0,n.useCallback)((e,t,s)=>{a({type:"MOVE_CLIP_TO_TRACK",clipId:e,targetTrackId:t,newStartTime:s})},[a]),D=(0,n.useCallback)(e=>{let a=t.project.tracks.find(t=>t.id===e);return a?a.clipIds.map(e=>t.clips.find(t=>t.id===e)).filter(Boolean):[]},[t.project.tracks,t.clips]),w=(0,n.useCallback)(()=>t.ui.selectedClipId&&t.clips.find(e=>e.id===t.ui.selectedClipId)||null,[t.ui.selectedClipId,t.clips]),I={onNudgeLeft:()=>S(t.ui.selectedClipId||"",-.1),onNudgeRight:()=>S(t.ui.selectedClipId||"",.1),onShortenClip:()=>T(t.ui.selectedClipId||"",-1),onLengthenClip:()=>T(t.ui.selectedClipId||"",1),onTogglePlayback:x,onRestartPlayback:k,getSelectedClip:w,getBPM:()=>t.project.bpm,getTimeSignature:()=>t.project.timeSignature,getProjectDuration:()=>t.project.duration,isPlaying:()=>t.audioEngine.isPlaying};(0,n.useEffect)(()=>(d.current||(d.current=new Z(I),d.current.enable()),()=>{var e;null==(e=d.current)||e.disable(),d.current=null}),[]),(0,n.useEffect)(()=>{d.current&&d.current.updateConfig(I)},[S,T,x,k,w,t.project.bpm,t.project.timeSignature,t.project.duration,t.audioEngine.isPlaying]);let{dragProps:M}=function(e){let{onFilesDropped:t,onDragEnter:a,onDragLeave:s,onDragOver:i}=e,o=(0,n.useRef)({isDragOver:!1,dragType:null,hoveredElement:null}),r=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),Array.from(e.dataTransfer.types).includes("Files")&&(o.current={isDragOver:!0,dragType:"file",hoveredElement:e.currentTarget},null==a||a(o.current))},[a]),c=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=e.relatedTarget;e.currentTarget.contains(t)||(o.current={isDragOver:!1,dragType:null,hoveredElement:null},null==s||s(o.current))},[s]);return{dragProps:{onDragEnter:r,onDragLeave:c,onDragOver:(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),null==i||i(o.current)},[i]),onDrop:(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),o.current={isDragOver:!1,dragType:null,hoveredElement:null};let a=Array.from(e.dataTransfer.files).filter(l);a.length>0&&t(a),null==s||s(o.current)},[t,s])},isDragOver:o.current.isDragOver}}({onFilesDropped:c,onDragEnter:()=>{a({type:"SET_DRAG_STATE",dragState:{isDragging:!0,dragType:"file"}})},onDragLeave:()=>{a({type:"RESET_DRAG_STATE"})}}),L=(0,n.useMemo)(()=>isNaN(t.project.duration)?g(t.project.tracks):t.project.duration||16,[t]),O=(0,n.useCallback)(e=>{t.ui.dragState.isDragging&&"file"===t.ui.dragState.dragType&&a({type:"SET_DRAG_STATE",dragState:{hoveredTrackId:e}})},[a,t.ui.dragState]),F=o(t.audioEngine.currentSamples),G=t.ui.pixelsPerSecond;return(0,s.jsxs)("div",{className:"main-audio-view",children:[(null==(e=d.current)?void 0:e.enabled)&&(0,s.jsx)("div",{className:"hotkeys-indicator",title:"Keyboard shortcuts are active",children:"\uD83C\uDFB9"}),(0,s.jsx)(Y,{isPlaying:t.audioEngine.isPlaying,currentTime:F,bpm:t.project.bpm,timeSignature:t.project.timeSignature,volume:t.audioEngine.volume,isLooping:t.audioEngine.isLooping,onPlay:m,onPause:h,onStop:f,onVolumeChange:y,onLoopToggle:v,onUserGesture:b}),(0,s.jsx)("div",{className:"audio-workspace",children:(0,s.jsxs)("div",{className:"tracks-area",...M,children:[(0,s.jsx)(R,{duration:L,currentTime:F,pixelsPerSecond:t.ui.pixelsPerSecond,bpm:t.project.bpm,timeSignature:t.project.timeSignature,isCollapsed:u,onScrub:E,onZoomChange:P,onToggleCollapse:()=>p(e=>!e)}),(0,s.jsxs)("div",{className:"tracks-container",children:[0===t.project.tracks.length&&(0,s.jsxs)("div",{className:"empty-tracks-message",children:[(0,s.jsx)("p",{children:"Drop audio files here to get started"}),(0,s.jsx)("p",{className:"empty-tracks-subtitle",children:"or create a track manually"}),(0,s.jsxs)("button",{className:"btn-primary add-track-button-empty",onClick:N,title:"Add new audio track",children:[(0,s.jsx)($,{size:16}),"Add Track"]})]}),t.project.tracks.flatMap(e=>D(e.id)).map(e=>(0,s.jsx)(U,{clip:e,pixelsPerSecond:G,trackHeight:64},e.id)),t.project.tracks.map(e=>(0,s.jsx)(V,{track:{...e},pixelsPerSecond:t.ui.pixelsPerSecond,trackHeight:64,projectDuration:L,selectedClipId:t.ui.selectedClipId,isCollapsed:u,onTrackUpdate:C,onClipSelect:j,onClipMove:S,onClipResize:T,onClipMoveToTrack:A,onTrackRemove:e=>a({type:"REMOVE_TRACK",trackId:e}),onFileUpload:c,onTrackHover:O,isHovered:t.ui.dragState.hoveredTrackId===e.id,showPlaceholder:t.ui.dragState.isDragging&&"file"===t.ui.dragState.dragType},e.id)),t.ui.dragState.isDragging&&"file"===t.ui.dragState.dragType&&!t.ui.dragState.hoveredTrackId&&(0,s.jsx)("div",{className:"new-track-placeholder",children:(0,s.jsx)("div",{className:"placeholder-content",children:(0,s.jsx)("span",{children:"Drop here to create new track"})})}),(0,s.jsx)("div",{className:"add-track-container",children:(0,s.jsxs)("button",{className:"btn-primary add-track-button",onClick:N,title:"Add new audio track",children:[(0,s.jsx)($,{size:16}),"Add Track"]})})]})]})})]})},J=function(){return(0,n.useCallback)(()=>{let e=e=>{e.preventDefault()};(0,n.useEffect)(()=>(document.addEventListener("wheel",e,{passive:!1,capture:!1}),()=>{document.removeEventListener("wheel",e)}),[])},[])(),(0,s.jsxs)("div",{className:"app",children:[(0,s.jsxs)("header",{className:"app-header",children:[(0,s.jsx)("h1",{children:"audioblocks"}),(0,s.jsx)("p",{children:"audio-streams"})]}),(0,s.jsx)("main",{className:"app-main",children:(0,s.jsx)(T,{children:(0,s.jsx)(Q,{})})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[481,441,684,358],()=>t(3037)),_N_E=e.O()}]);